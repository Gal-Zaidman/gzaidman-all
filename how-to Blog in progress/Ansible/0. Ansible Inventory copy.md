---
title: "The Ansible Inventory, Ansible zero to hero Part 1"
date: 2020-06-19T00:00:01+03:00
draft: false

# post thumb
image: "images/ansible/inventory.png"

# meta description
author: "Gal Zaidman"
description: "Part 1 of the ansible zero to hero course, here we introduce the ansible inventory in all its many forms"

# taxonomies
categories:
  - "Ansible"
  - "Full course"

tags:
  - "Ansible"
  - "FullCourse"
  - "GettingStarted"

# post type
type: "post"
---

# Ansible Inventory

An inventory defines a collection of hosts that Ansible will manage.

There are 2 types of inventories:

- static: defined by a INI-style or YAML text file that specifies the managed hosts.
- dynamic: generated by a script or other program as needed, using external information providers.

## Groups

The simplest form of an inventory is just a list of hosts, but as the system becomes more complex we can use hosts groups to assign a label to a collection of hosts.
Groups can contain child groups, and hosts can be members of multiple groups.
There are two default groups:

- all - contains every host.
- ungrouped. contains all hosts that donâ€™t have another group aside from all.

## Static Inventory

In a static inventory we list the hosts that we want ansible to manage.
We can list the hosts as IP addresses or via hostname.
Usually we want to organize the managed hosts into host groups so we could select a group of hosts with a specific function, a host can be in multiple groups.

```ini
[usa]
washington1.example.com
washington2.example.com

[canada]
ontario01.example.com
ontario02.example.com
```

We can include groups of host groups with the :children suffix:

```ini
[north-america:children]
canada
usa
```

We can use ranges in the host names or IP addresses to make the inventory shorter, the above can be:

```ini
[usa]
washington[1:2].example.com

[canada]
ontario[01:02].example.com
```

To verify the inventory we can use:

```bash
ansible HOST/GROUP --list-hosts
# for example
ansible canada --list-hosts
```

### Inventory Location:

The inventory can be in the following locations (ordered by precedence):

1. parameter: ansible/ansible-playbook --inventory PATHNAME or -i PATHNAME.
2. Ansible configuration file with the inventory= parameter.
3. default location: /etc/ansible/host system's default static inventory file.

### Adding variables to the inventory

You can store variable values that relate to a specific host or group in inventory.

#### host variables

```ini
[canada]
host1 http_port=80 maxRequestsPerChild=808
host2 http_port=303 maxRequestsPerChild=909
```

#### Group variables

```ini
[canada]
host1
host2

[canada:vars]
ntp_server=ntp.canada.example.com
proxy=proxy.canada.example.com
```

#### Organizing host and group variables

Adding all the variables on the main inventory file can make the file very complicated.
Storing separate host and group variables files may help organize the variable values more easily.
Host and group variable files are defined in a host_vars and group_vars directories and must use a YAML syntax. must use YAML syntax.

```yaml
ntp_server: acme.example.org
database_server: storage.example.org
```

You can also create directories named after your groups or hosts. Ansible will read all the files in these directories in lexicographical order.
An example with the 'canada' group:

/etc/ansible/group_vars/canada/db_settings
/etc/ansible/group_vars/canada/cluster_settings

This can be very useful to keep your variables organized when a single file gets too big, or when you want to use Ansible Vault on some group variables.

### Examples

To see examples on different inventories go to the docs on:

https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#inventory-setup-examples

### Configurations

There are a lot of flags we can set to control the way ansible connects to our hosts.
They are listed on the docs at:

https://docs.ansible.com/ansible/latest/user_guide/intro_inventory.html#inventory-setup-examples

## Dynamic Inventory

When working with numerous machines or in an environment where machines come and go very quickly, it can be hard to keep the static inventory files up-to-date.
In a large IT environment we keep track of which hosts are available and how they are organized.
Ansible supports dynamic inventory scripts that retrieve current information external sources, allowing the inventory to be created in real time based on the current env.
These scripts collect information from an external source and create JSON format inventory file.

If the inventory file is executable, then it is treated as a dynamic inventory program and Ansible attempts to run it to generate the inventory. If the file is not executable, then it is treated as a static inventory.

### Writing Dynamic Inventory Programs

If a dynamic inventory script does not exist for the infrastructure in use, you can write a custom dynamic inventory program. This is a link to the ansible doc for writing a dynamic inventory [link](https://docs.ansible.com/ansible/latest/dev_guide/developing_inventory.html).
A few thing we should keep in mind:

- Can be written in any programming language, but must have an appropriate interpreter line (for example, #!/usr/bin/python).
- Thw script must be executiable.
- The script should return inventory information in JSON format.
- When passed the --list option, the script must print a JSON-encoded hash/dictionary of all the hosts and groups in the inventory.
- When passed the the --host HOST option, the script must print a JSON hash/dictionary consisting of variables which are associated with that host, or an empty JSON hash/dictionary.

Example of a dynamic inventory output:

``` json
{
   "webservers" : [
      "web1.demo.example.com",
      "web2.demo.example.com"
   ],
   "boston" : {
      "children" : [
         "backup",
         "ipa"
      ],
      "vars" : {
         "example_host" : false
      },
      "hosts" : [
         "server1.demo.example.com",
         "server2.demo.example.com",
         "server3.demo.example.com"
      ]
   },
   "backup" : [
      "server4.demo.example.com"
   ],
   "ipa" : [
      "server5.demo.example.com"
   ],
   "_meta" : {
      "hostvars" : {
        "server5.demo.example.com": {
          "ntpserver": "ntp.demo.example.com",
          "dnsserver": "dns.demo.example.com"
        }
      }
   }
}
```
To display the contents of the inventory file in JSON format, run the ansible-inventory --list command.

```bash
[student@workstation projects-host]$ cat inventory
workstation1.lab.example.com

[webservers]
web1.lab.example.com
web2.lab.example.com

[databases]
db1.lab.example.com
db2.lab.example.com

[student@workstation projects-host]$ ansible-inventory -i inventory --list
{
    "_meta": {
        "hostvars": {
            "db1.lab.example.com": {},
            "db2.lab.example.com": {},
            "web1.lab.example.com": {},
            "web2.lab.example.com": {},
            "workstation1.lab.example.com": {}
        }
    },
    "all": {
        "children": [
            "databases",
            "ungrouped",
            "webservers"
        ]
    },
    "databases": {
        "hosts": [
            "db1.lab.example.com",
            "db2.lab.example.com"
        ]
    },
    "ungrouped": {
        "hosts": [
            "workstation1.lab.example.com"
        ]
    },
    "webservers": {
        "hosts": [
            "web1.lab.example.com",
            "web2.lab.example.com"
        ]
    }
}
```